<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Agenda 2 - Nossas Metas, Matt!</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üìÖ</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #6d5dfc 0%, #43cbff 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            width: 100%;
            max-width: 1200px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
            margin: 20px 0;
        }
        
        header {
            background: #6d5dfc;
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        header h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .back-btn {
            position: absolute;
            top: 20px;
            left: 20px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .back-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateX(-5px);
        }
        
        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }
        
        .tab {
            padding: 15px 25px;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.3s;
            border-bottom: 3px solid transparent;
        }
        
        .tab:hover {
            background: #e9ecef;
        }
        
        .tab.active {
            border-bottom: 3px solid #6d5dfc;
            color: #6d5dfc;
        }
        
        .agenda-container {
            padding: 20px;
        }
        
        .agenda-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .month-nav {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .nav-btn {
            background: #6d5dfc;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .nav-btn:hover {
            background: #5a4de0;
        }
        
        .current-month {
            font-size: 1.5rem;
            font-weight: 600;
            color: #6d5dfc;
            min-width: 180px;
            text-align: center;
        }
        
        .view-options {
            display: flex;
            gap: 10px;
        }
        
        .view-btn {
            padding: 8px 15px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .view-btn.active {
            background: #6d5dfc;
            color: white;
            border-color: #6d5dfc;
        }
        
        .agenda-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 20px;
        }
        
        @media (max-width: 900px) {
            .agenda-content {
                grid-template-columns: 1fr;
            }
        }
        
        .day-view {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        
        .selected-date {
            text-align: center;
            margin-bottom: 20px;
            font-size: 1.2rem;
            color: #6d5dfc;
            font-weight: 600;
        }
        
        .time-slots {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 650px;
            overflow-y: auto;
        }
        
        .time-slot {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .time-label {
            min-width: 80px;
            font-weight: 600;
            color: #6c757d;
        }
        
        .event-content {
            flex: 1;
            padding: 10px;
            border-radius: 5px;
            color: white;
            cursor: pointer;
            min-height: 40px;
            display: flex;
            align-items: center;
        }
        
        .event-content.empty {
            background: #e9ecef;
            color: #6c757d;
            font-style: italic;
            justify-content: center;
        }
        
        .event-content.fixed {
            opacity: 0.8;
            cursor: not-allowed;
        }
        
        .event-content.fixed::after {
            content: " (Fixo)";
            font-size: 0.7em;
            opacity: 0.7;
        }
        
        .add-event-btn {
            background: #6d5dfc;
            color: white;
            border: none;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }
        
        .add-event-btn:hover {
            background: #5a4de0;
        }
        
        .event-form-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
        }
        
        .event-form-panel h3 {
            margin-bottom: 15px;
            color: #6d5dfc;
            text-align: center;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }
        
        .form-group input, .form-group textarea, .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 1rem;
        }
        
        .form-group textarea {
            min-height: 80px;
            resize: vertical;
        }
        
        .color-picker {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }
        
        .color-option.selected {
            border: 2px solid #333;
            transform: scale(1.1);
        }
        
        .btn {
            padding: 10px 20px;
            background: #6d5dfc;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            transition: all 0.3s;
            width: 100%;
            margin-top: 10px;
        }
        
        .btn:hover {
            background: #5a4de0;
        }
        
        .btn-delete {
            background: #dc3545;
        }
        
        .btn-delete:hover {
            background: #bd2130;
        }
        
        .events-list {
            margin-top: 20px;
        }
        
        .events-list h3 {
            margin-bottom: 10px;
            color: #6d5dfc;
        }
        
        .event-card {
            background: white;
            border-left: 4px solid #6d5dfc;
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 4px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .event-title {
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .event-date {
            font-size: 0.85rem;
            color: #6c757d;
        }
        
        .event-actions {
            margin-top: 10px;
            display: flex;
            gap: 10px;
        }
        
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            color: #ced4da;
        }
        
        footer {
            text-align: center;
            margin-top: 20px;
            color: white;
            opacity: 0.8;
        }
        
        @media (max-width: 768px) {
            .tabs {
                flex-wrap: wrap;
            }
            
            .tab {
                flex: 1;
                text-align: center;
                padding: 12px 5px;
                font-size: 0.9rem;
            }
            
            .agenda-header {
                flex-direction: column;
                align-items: stretch;
            }
            
            .time-slot {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .time-label {
                min-width: auto;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <a href="index.html" class="back-btn">‚Üê Voltar</a>
            <h1>Que todas as nossas metas sejam poss√≠veis!</h1>
            <p>Nosso cronograma di√°rio - Agenda Matt!</p>
        </header>
        
        <div class="tabs">
            <div class="tab" onclick="location.href='fotos.html'">Fotos</div>
            <div class="tab" onclick="location.href='lista.html'">Lista</div>
            <div class="tab" onclick="location.href='calendario.html'">Calend√°rio</div>
            <div class="tab active">Cronograma 2</div>
        </div>
        
        <div class="agenda-container">
            <div class="agenda-header">
                <div class="month-nav">
                    <button class="nav-btn" id="prev-day"><i class="fas fa-chevron-left"></i></button>
                    <h2 class="current-month" id="selected-date">20 de Agosto de 2025</h2>
                    <button class="nav-btn" id="next-day"><i class="fas fa-chevron-right"></i></button>
                </div>
                <div class="view-options">
                    <button class="view-btn" id="today-btn">Hoje</button>
                    <input type="date" id="date-picker" style="padding: 8px; border-radius: 20px; border: 1px solid #ced4da;">
                </div>
            </div>
            
            <div class="agenda-content">
                <div class="day-view">
                    <div class="selected-date" id="day-title">Quinta-feira, 20 de Agosto de 2025</div>
                    
                    <div class="time-slots" id="time-slots">
                        <!-- Os hor√°rios ser√£o gerados via JavaScript -->
                    </div>
                </div>
                
                <div class="event-form-panel">
                    <h3 id="form-title">Novo Evento</h3>
                    <div class="form-group">
                        <label for="event-time">Hor√°rio</label>
                        <select id="event-time">
                            <!-- Os hor√°rios ser√£o preenchidos via JavaScript -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="event-title">T√≠tulo</label>
                        <input type="text" id="event-title" placeholder="Nome do evento">
                    </div>
                    <div class="form-group">
                        <label for="event-desc">Descri√ß√£o (opcional)</label>
                        <textarea id="event-desc" placeholder="Detalhes do evento"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Cor do evento</label>
                        <div class="color-picker" id="color-picker">
                            <div class="color-option selected" style="background-color: #6d5dfc;" data-color="#6d5dfc"></div>
                            <div class="color-option" style="background-color: #4caf50;" data-color="#4caf50"></div>
                            <div class="color-option" style="background-color: #ff9800;" data-color="#ff9800"></div>
                            <div class="color-option" style="background-color: #f44336;" data-color="#f44336"></div>
                            <div class="color-option" style="background-color: #9c27b0;" data-color="#9c27b0"></div>
                            <div class="color-option" style="background-color: #00bcd4;" data-color="#00bcd4"></div>
                        </div>
                        <input type="color" id="custom-color-input" value="#6d5dfc" style="width: 100%; margin-top: 10px; height: 40px;">
                    </div>
                    <button class="btn" id="save-event">Salvar Evento</button>
                    <button class="btn btn-delete" id="delete-event" style="display: none;">Excluir Evento</button>
                </div>
            </div>
        </div>
    </div>
    
    <footer>
        <p>¬© 2025 ‚Äî M&A</p>
    </footer>

    <!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script> <!-- ADICIONE ESTA LINHA -->
<script src="js/common.js"></script>
    <script>
        // schedule2.js - L√≥gica do cronograma di√°rio para Agenda 2

        // Verificar se o Firebase foi inicializado e autenticado
function checkFirebaseInitialization() {
    return new Promise((resolve, reject) => {
        // Verificar se o Firebase j√° foi inicializado
        if (typeof firebase !== 'undefined' && firebase.apps.length > 0) {
            // Verificar se j√° est√° autenticado
            if (firebase.auth().currentUser) {
                resolve();
                return;
            }
            
            // Esperar pela autentica√ß√£o
            const authListener = firebase.auth().onAuthStateChanged((user) => {
                if (user) {
                    authListener(); // Remover o listener
                    resolve();
                }
            });
            
            // Tentar autentica√ß√£o an√¥nima se n√£o estiver autenticado
            firebase.auth().signInAnonymously()
                .catch((error) => {
                    console.error('Erro na autentica√ß√£o:', error);
                    reject(error);
                });
                
        } else {
            reject(new Error('Firebase n√£o foi inicializado. Verifique o common.js.'));
        }
    });
}

        // Vari√°veis globais
        let selectedDate = new Date();
        let selectedEventId = null;
        let selectedColor = '#6d5dfc';
        let selectedTime = '08:00';

        // Elementos do DOM
        const selectedDateElement = document.getElementById('selected-date');
        const dayTitleElement = document.getElementById('day-title');
        const prevDayButton = document.getElementById('prev-day');
        const nextDayButton = document.getElementById('next-day');
        const todayButton = document.getElementById('today-btn');
        const datePicker = document.getElementById('date-picker');
        const timeSlotsContainer = document.getElementById('time-slots');
        const eventTimeSelect = document.getElementById('event-time');
        const eventTitleInput = document.getElementById('event-title');
        const eventDescInput = document.getElementById('event-desc');
        const saveEventButton = document.getElementById('save-event');
        const deleteEventButton = document.getElementById('delete-event');
        const formTitle = document.getElementById('form-title');
        const colorOptions = document.querySelectorAll('.color-option');
        const customColorInput = document.getElementById('custom-color-input');

        // Nomes dos dias da semana
        const dayNames = ["Domingo", "Segunda-feira", "Ter√ßa-feira", "Quarta-feira", "Quinta-feira", "Sexta-feira", "S√°bado"];
        const monthNames = ["Janeiro", "Fevereiro", "Mar√ßo", "Abril", "Maio", "Junho", "Julho", "Agosto", "Setembro", "Outubro", "Novembro", "Dezembro"];

        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            checkFirebaseInitialization()
                .then(() => {
                    initAgenda();
                })
                .catch((error) => {
                    console.error("Erro na inicializa√ß√£o do Firebase:", error);
                    alert("Erro ao conectar com o banco de dados. Verifique o console para detalhes.");
                });
        });

        function initAgenda() {
            // Definir data atual como padr√£o
            const today = new Date();
            const formattedToday = formatDateLocal(today);
            datePicker.value = formattedToday;
            
            // Preencher sele√ß√£o de hor√°rios
            populateTimeOptions();
            
            // Renderizar o cronograma do dia
            renderDayView();
            loadDayEvents();
            
            // Event Listeners
            prevDayButton.addEventListener('click', goToPreviousDay);
            nextDayButton.addEventListener('click', goToNextDay);
            todayButton.addEventListener('click', goToToday);
            datePicker.addEventListener('change', handleDateChange);
            
            saveEventButton.addEventListener('click', saveEvent);
            deleteEventButton.addEventListener('click', deleteEvent);
            
            // Listeners para sele√ß√£o de cor
            colorOptions.forEach(option => {
                option.addEventListener('click', function() {
                    selectColor(this.getAttribute('data-color'));
                });
            });
            
            customColorInput.addEventListener('input', function() {
                selectColor(this.value);
            });
            
            // Listener para sele√ß√£o de hor√°rio no formul√°rio
            eventTimeSelect.addEventListener('change', function() {
                selectedTime = this.value;
            });
        }

        // Fun√ß√£o para formatar data no formato YYYY-MM-DD (fuso local)
        function formatDateLocal(date) {
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            return `${year}-${month}-${day}`;
        }

        // Preencher op√ß√µes de hor√°rio
        function populateTimeOptions() {
            eventTimeSelect.innerHTML = '';
            
            // Das 5:00 √†s 23:30
            for (let hour = 5; hour <= 23; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const timeValue = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    const option = document.createElement('option');
                    option.value = timeValue;
                    option.textContent = timeValue;
                    eventTimeSelect.appendChild(option);
                }
            }
            
            // Adicionar meia-noite (00:00)
            const midnightOption = document.createElement('option');
            midnightOption.value = '00:00';
            midnightOption.textContent = '00:00';
            eventTimeSelect.appendChild(midnightOption);
            
            // Definir hor√°rio padr√£o
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes() < 30 ? '00' : '30';
            selectedTime = `${currentHour.toString().padStart(2, '0')}:${currentMinute}`;
            eventTimeSelect.value = selectedTime;
        }

        // Fun√ß√£o para renderizar a visualiza√ß√£o do dia
        function renderDayView() {
            // Atualizar o cabe√ßalho com a data selecionada
            updateDateDisplay();
            
            // Limpar os slots de tempo
            timeSlotsContainer.innerHTML = '';
            
            // Das 5:00 √†s 23:30
            for (let hour = 5; hour <= 23; hour++) {
                for (let minute = 0; minute < 60; minute += 30) {
                    const timeValue = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                    
                    const timeSlot = document.createElement('div');
                    timeSlot.className = 'time-slot';
                    timeSlot.setAttribute('data-time', timeValue);
                    
                    timeSlot.innerHTML = `
                        <div class="time-label">${timeValue}</div>
                        <div class="event-content empty" data-time="${timeValue}">Clique para adicionar evento</div>
                        <button class="add-event-btn" data-time="${timeValue}">+</button>
                    `;
                    
                    // Event listeners
                    const eventContent = timeSlot.querySelector('.event-content');
                    const addButton = timeSlot.querySelector('.add-event-btn');
                    
                    eventContent.addEventListener('click', function() {
                        const time = this.getAttribute('data-time');
                        editEventAtTime(time);
                    });
                    
                    addButton.addEventListener('click', function() {
                        const time = this.getAttribute('data-time');
                        addEventAtTime(time);
                    });
                    
                    timeSlotsContainer.appendChild(timeSlot);
                }
            }
            
            // Adicionar slot para meia-noite (00:00)
            const midnightSlot = document.createElement('div');
            midnightSlot.className = 'time-slot';
            midnightSlot.setAttribute('data-time', '00:00');
            
            midnightSlot.innerHTML = `
                <div class="time-label">00:00</div>
                <div class="event-content empty" data-time="00:00">Clique para adicionar evento</div>
                <button class="add-event-btn" data-time="00:00">+</button>
            `;
            
            const midnightEventContent = midnightSlot.querySelector('.event-content');
            const midnightAddButton = midnightSlot.querySelector('.add-event-btn');
            
            midnightEventContent.addEventListener('click', function() {
                const time = this.getAttribute('data-time');
                editEventAtTime(time);
            });
            
            midnightAddButton.addEventListener('click', function() {
                const time = this.getAttribute('data-time');
                addEventAtTime(time);
            });
            
            timeSlotsContainer.appendChild(midnightSlot);
        }

        // Fun√ß√£o para verificar se √© dia de semana (segunda a sexta)
        function isWeekday(date) {
            const day = date.getDay();
            return day >= 1 && day <= 5; // 1 = segunda, 5 = sexta
        }

        // Fun√ß√£o para criar eventos fixos - AGENDA 2
        function createFixedEvents() {
            const formattedDate = formatDateLocal(selectedDate);
            
            // Verificar se √© dia de semana (segunda a sexta)
            if (isWeekday(selectedDate)) {
                // Criar evento fixo das 07:30 √†s 16:30 (Trabalho) - AGENDA 2
                for (let hour = 7; hour <= 16; hour++) {
                    // Para a hora 7, s√≥ adicionamos o hor√°rio das 7:30
                    if (hour === 7) {
                        const time = "07:30";
                        const eventKey = `${formattedDate}_${time.replace(':', '')}`;
                        
                        // Verificar se o evento j√° existe na cole√ß√£o da AGENDA 2
                        db.collection('daily_schedule_agenda2').doc(eventKey).get()
                            .then((doc) => {
                                if (!doc.exists) {
                                    // Criar evento fixo
                                    const eventData = {
                                        date: formattedDate,
                                        time: time,
                                        title: "Trabalho",
                                        description: "Hor√°rio de trabalho fixo - Agenda 2",
                                        color: "#4caf50", // Verde
                                        isFixed: true,
                                        createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                    };
                                    
                                    db.collection('daily_schedule_agenda2').doc(eventKey).set(eventData)
                                        .catch((error) => {
                                            console.error("Erro ao criar evento fixo: ", error);
                                        });
                                }
                            })
                            .catch((error) => {
                                console.error("Erro ao verificar evento fixo: ", error);
                            });
                    } else {
                        // Para outras horas, adicionamos ambos os hor√°rios (00 e 30)
                        for (let minute = 0; minute < 60; minute += 30) {
                            // Para a hora 16, s√≥ vamos at√© 16:30
                            if (hour === 16 && minute > 30) break;
                            
                            const time = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                            const eventKey = `${formattedDate}_${time.replace(':', '')}`;
                            
                            // Verificar se o evento j√° existe na cole√ß√£o da AGENDA 2
                            db.collection('daily_schedule_agenda2').doc(eventKey).get()
                                .then((doc) => {
                                    if (!doc.exists) {
                                        // Criar evento fixo
                                        const eventData = {
                                            date: formattedDate,
                                            time: time,
                                            title: "Trabalho",
                                            description: "Hor√°rio de trabalho fixo - Agenda 2",
                                            color: "#4caf50", // Verde
                                            isFixed: true,
                                            createdAt: firebase.firestore.FieldValue.serverTimestamp()
                                        };
                                        
                                        db.collection('daily_schedule_agenda2').doc(eventKey).set(eventData)
                                            .catch((error) => {
                                                console.error("Erro ao criar evento fixo: ", error);
                                            });
                                    }
                                })
                                .catch((error) => {
                                    console.error("Erro ao verificar evento fixo: ", error);
                                });
                        }
                    }
                }
            }
        }

        // Fun√ß√£o para atualizar o display da data
        function updateDateDisplay() {
            const dayName = dayNames[selectedDate.getDay()];
            const day = selectedDate.getDate();
            const month = monthNames[selectedDate.getMonth()];
            const year = selectedDate.getFullYear();
            
            selectedDateElement.textContent = `${day} de ${month} de ${year}`;
            dayTitleElement.textContent = `${dayName}, ${day} de ${month} de ${year}`;
            
            // Atualizar o date picker
            const formattedDate = formatDateLocal(selectedDate);
            datePicker.value = formattedDate;
        }

        // Fun√ß√£o para navegar para o dia anterior
        function goToPreviousDay() {
            selectedDate.setDate(selectedDate.getDate() - 1);
            renderDayView();
            loadDayEvents();
        }

        // Fun√ß√£o para navegar para o pr√≥ximo dia
        function goToNextDay() {
            selectedDate.setDate(selectedDate.getDate() + 1);
            renderDayView();
            loadDayEvents();
        }

        // Fun√ß√£o para navegar para a data atual
        function goToToday() {
            selectedDate = new Date();
            renderDayView();
            loadDayEvents();
        }

        // Fun√ß√£o para lidar com mudan√ßa de data no date picker
        function handleDateChange() {
            selectedDate = new Date(this.value);
            renderDayView();
            loadDayEvents();
        }

        // Fun√ß√£o para adicionar evento em um hor√°rio espec√≠fico
        function addEventAtTime(time) {
            selectedTime = time;
            eventTimeSelect.value = time;
            
            // Limpar formul√°rio
            eventTitleInput.value = '';
            eventDescInput.value = '';
            selectedEventId = null;
            deleteEventButton.style.display = 'none';
            formTitle.textContent = 'Novo Evento';
            
            // Selecionar cor padr√£o
            selectColor('#6d5dfc');
            
            // Scroll para o formul√°rio
            eventTimeSelect.scrollIntoView({ behavior: 'smooth' });
        }

        // Fun√ß√£o para editar evento em um hor√°rio espec√≠fico
        function editEventAtTime(time) {
            // Buscar evento neste hor√°rio na cole√ß√£o da AGENDA 2
            const formattedDate = formatDateLocal(selectedDate);
            const eventKey = `${formattedDate}_${time.replace(':', '')}`;
            
            db.collection('daily_schedule_agenda2').doc(eventKey).get()
                .then((doc) => {
                    if (doc.exists) {
                        const event = doc.data();
                        
                        // Verificar se √© um evento fixo
                        if (event.isFixed) {
                            alert("Este √© um evento fixo e n√£o pode ser editado.");
                            return;
                        }
                        
                        selectedTime = event.time;
                        eventTimeSelect.value = event.time;
                        eventTitleInput.value = event.title;
                        eventDescInput.value = event.description || '';
                        
                        selectedEventId = eventKey;
                        deleteEventButton.style.display = 'inline-block';
                        formTitle.textContent = 'Editar Evento';
                        
                        // Selecionar a cor do evento
                        if (event.color) {
                            selectColor(event.color);
                        }
                        
                        // Scroll para o formul√°rio
                        eventTimeSelect.scrollIntoView({ behavior: 'smooth' });
                    } else {
                        // Se n√£o existir evento, criar um novo
                        addEventAtTime(time);
                    }
                })
                .catch((error) => {
                    console.error("Erro ao carregar evento: ", error);
                });
        }

        // Fun√ß√£o para selecionar uma cor
        function selectColor(color) {
            selectedColor = color;
            customColorInput.value = color;
            
            // Atualizar UI
            colorOptions.forEach(option => {
                if (option.getAttribute('data-color') === color) {
                    option.classList.add('selected');
                } else {
                    option.classList.remove('selected');
                }
            });
        }

        // Fun√ß√£o para carregar eventos do dia
        function loadDayEvents() {
            const formattedDate = formatDateLocal(selectedDate);
            
            // Criar eventos fixos para dias de semana
            createFixedEvents();
            
            // Buscar eventos do dia na cole√ß√£o da AGENDA 2
            db.collection('daily_schedule_agenda2')
                .where('date', '==', formattedDate)
                .get()
                .then((querySnapshot) => {
                    // Limpar todos os eventos visuais primeiro
                    document.querySelectorAll('.event-content').forEach(el => {
                        el.className = 'event-content empty';
                        el.textContent = 'Clique para adicionar evento';
                    });
                    
                    // Preencher com os eventos do banco
                    querySnapshot.forEach((doc) => {
                        const event = doc.data();
                        displayEventOnSchedule(event);
                    });
                })
                .catch((error) => {
                    console.error("Erro ao carregar eventos: ", error);
                });
        }

        // Fun√ß√£o para exibir evento no cronograma
        function displayEventOnSchedule(event) {
            const timeSlot = document.querySelector(`.event-content[data-time="${event.time}"]`);
            if (timeSlot) {
                timeSlot.className = 'event-content';
                timeSlot.style.backgroundColor = event.color || '#6d5dfc';
                timeSlot.textContent = event.title;
                timeSlot.setAttribute('data-event-id', `${event.date}_${event.time.replace(':', '')}`);
                
                // Marcar eventos fixos
                if (event.isFixed) {
                    timeSlot.classList.add('fixed');
                    timeSlot.title = "Evento fixo - n√£o pode ser editado";
                }
            }
        }

        // Fun√ß√£o para salvar evento
        function saveEvent() {
            const time = eventTimeSelect.value;
            const title = eventTitleInput.value;
            const description = eventDescInput.value;
            const color = selectedColor;
            const formattedDate = formatDateLocal(selectedDate);
            
            if (!time || !title) {
                alert('Por favor, preencha pelo menos o hor√°rio e o t√≠tulo do evento.');
                return;
            }
            
            const eventData = {
                date: formattedDate,
                time: time,
                title: title,
                description: description,
                color: color,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            const eventKey = `${formattedDate}_${time.replace(':', '')}`;
            
            if (selectedEventId) {
                // Atualizar evento existente na cole√ß√£o da AGENDA 2
                db.collection('daily_schedule_agenda2').doc(selectedEventId).update(eventData)
                    .then(() => {
                        alert('Evento atualizado com sucesso!');
                        resetForm();
                        loadDayEvents();
                    })
                    .catch((error) => {
                        console.error("Erro ao atualizar evento: ", error);
                        alert('Erro ao atualizar evento. Tente novamente.');
                    });
            } else {
                // Adicionar novo evento na cole√ß√£o da AGENDA 2
                db.collection('daily_schedule_agenda2').doc(eventKey).set(eventData)
                    .then(() => {
                        alert('Evento adicionado com sucesso!');
                        resetForm();
                        loadDayEvents();
                    })
                    .catch((error) => {
                        console.error("Erro ao adicionar evento: ", error);
                        alert('Erro ao adicionar evento. Tente novamente.');
                    });
            }
        }

        // Fun√ß√£o para excluir evento
        function deleteEvent() {
            if (!selectedEventId) {
                alert('Nenhum evento selecionado para exclus√£o.');
                return;
            }
            
            if (confirm('Tem certeza que deseja excluir este evento?')) {
                // Excluir evento da cole√ß√£o da AGENDA 2
                db.collection('daily_schedule_agenda2').doc(selectedEventId).delete()
                    .then(() => {
                        alert('Evento exclu√≠do com sucesso!');
                        resetForm();
                        loadDayEvents();
                    })
                    .catch((error) => {
                        console.error("Erro ao excluir evento: ", error);
                        alert('Erro ao excluir evento. Tente novamente.');
                    });
            }
        }

        // Fun√ß√£o para reiniciar o formul√°rio
        function resetForm() {
            const now = new Date();
            const currentHour = now.getHours();
            const currentMinute = now.getMinutes() < 30 ? '00' : '30';
            selectedTime = `${currentHour.toString().padStart(2, '0')}:${currentMinute}`;
            
            eventTimeSelect.value = selectedTime;
            eventTitleInput.value = '';
            eventDescInput.value = '';
            
            selectedEventId = null;
            deleteEventButton.style.display = 'none';
            formTitle.textContent = 'Novo Evento';
            
            selectColor('#6d5dfc');
        }
    </script>
</body>

</html>

